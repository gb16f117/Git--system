# 中药方管理系统 - 使用说明

## 🌿 系统简介

中药方管理系统是一个基于Flask开发的Web应用，专门用于管理传统中医药方信息。系统提供了完整的药方管理功能和强大的搜索功能，特别适合中医药机构、研究机构和个人使用。

## 🚀 快速开始

### 方法一：使用启动脚本（推荐）

```bash
# 进入项目目录
cd 中药方管理系统

# 运行启动脚本
./start.sh
```

### 方法二：手动启动

```bash
# 1. 安装系统依赖
sudo apt install python3 python3-pip python3-venv -y

# 2. 创建虚拟环境
python3 -m venv venv
source venv/bin/activate

# 3. 安装Python依赖
pip install -r requirements.txt

# 4. 启动应用
python app.py
```

### 访问系统

启动成功后，在浏览器中访问：
- **本地访问**: http://localhost:5001
- **局域网访问**: http://[您的IP地址]:5001

## 📋 主要功能

### 1. 药方管理

#### 查看药方列表
- 系统首页显示所有药方
- 支持列表和网格两种视图
- 显示药方名称、分类、疗效简介等信息

#### 添加药方
1. 点击左侧"添加药方"按钮
2. 填写药方信息：
   - **药方名称**（必填）
   - **治疗疗效**（必填）- 重要：用于搜索的主要字段
   - **主要成分** - 用顿号分隔
   - **用法用量**
   - **注意事项**
   - **分类**
   - **来源/出处**
3. 点击"保存"完成添加

#### 编辑药方
1. 在药方详情页点击"编辑"按钮
2. 修改需要更新的信息
3. 点击"保存修改"

#### 删除药方
- 在药方列表中点击删除按钮
- 确认删除操作（不可恢复）

### 2. 智能搜索功能

#### 快速搜索
- 在顶部导航栏的搜索框输入关键词
- 支持药方名称、疗效、成分的模糊搜索

#### 高级搜索
访问"高级搜索"页面，提供更强大的搜索功能：

**搜索模式**：
- **模糊匹配**：最灵活的搜索方式（默认）
- **AND逻辑**：所有关键词都必须匹配
- **OR逻辑**：任一关键词匹配即可

**搜索技巧**：
- 支持多关键词搜索，用空格分隔
- 例如："清热 解毒" 会搜索同时包含这两个关键词的药方
- 支持部分匹配，不需要完整输入

**快捷标签**：
- 系统提供常用疗效关键词的快捷标签
- 点击标签自动添加到搜索框

### 3. 分类筛选

#### 按分类浏览
- 在左侧面板选择分类
- 系统自动筛选该分类下的所有药方

#### 预设分类
系统预设了常见的药方分类：
- 清热解毒类
- 滋阴补肾类
- 补益类
- 活血化瘀类
- 和解类

### 4. 搜索历史

#### 自动保存
- 系统自动保存最近10次搜索记录
- 显示搜索关键词、匹配方式和时间

#### 快捷重搜
- 点击历史记录可快速重新执行搜索
- 支持清空所有历史记录

### 5. 数据统计

#### 实时统计
- 显示药方总数
- 各分类药方数量分布
- 动态更新统计信息

## 🔧 API接口

系统提供RESTful API接口，支持第三方集成：

### 药方管理
```http
GET    /api/prescriptions           # 获取药方列表
GET    /api/prescriptions/{id}     # 获取药方详情
POST   /api/prescriptions           # 创建药方
PUT    /api/prescriptions/{id}     # 更新药方
DELETE /api/prescriptions/{id}     # 删除药方
```

### 搜索功能
```http
GET /api/prescriptions/search?q=关键词&match_type=fuzzy
```

参数说明：
- `q`: 搜索关键词
- `match_type`: 匹配模式（fuzzy/and/or）
- `limit`: 结果数量限制

### 其他接口
```http
GET /api/categories     # 获取所有分类
GET /api/stats          # 获取统计信息
```

## 📊 数据库设计

### 主要表结构

```sql
CREATE TABLE prescriptions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(100) NOT NULL,           -- 药方名称
    efficacy TEXT NOT NULL,               -- 治疗疗效（核心搜索字段）
    ingredients TEXT,                     -- 主要成分
    usage TEXT,                           -- 用法用量
    precautions TEXT,                     -- 注意事项
    category VARCHAR(50),                 -- 分类
    source VARCHAR(100),                  -- 来源/出处
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 索引优化
- 为疗效字段创建索引，优化搜索性能
- 支持高效的模糊匹配查询

## 🎯 使用技巧

### 搜索技巧
1. **关键词组合**：使用空格分隔多个关键词
2. **部分匹配**：不需要输入完整词语
3. **疗效搜索**：重点关注疗效字段的搜索
4. **成分搜索**：可以通过药材名称反向查找药方

### 数据管理技巧
1. **规范命名**：药方名称使用标准名称
2. **详细疗效**：疗效描述要详细具体
3. **分类统一**：使用标准分类体系
4. **来源标注**：注明药方的经典出处

## 📱 响应式设计

系统采用响应式设计，支持：
- **桌面端**：完整功能体验
- **平板端**：优化的触摸操作
- **手机端**：移动端友好界面

## 🔒 安全特性

- **SQL注入防护**：使用参数化查询
- **XSS攻击防护**：输入验证和输出转义
- **数据验证**：严格的输入数据验证

## 🛠️ 开发说明

### 项目结构
```
中药管理系统/
├── app.py              # Flask应用主文件
├── requirements.txt     # Python依赖
├── start.sh            # 启动脚本
├── test_api.py         # API测试脚本
├── README.md           # 项目说明
├── 使用说明.md          # 使用说明
├── static/             # 静态资源
│   ├── css/
│   │   └── style.css   # 自定义样式
│   └── js/
│       └── main.js     # JavaScript工具函数
├── templates/          # HTML模板
│   ├── base.html       # 基础模板
│   ├── index.html      # 首页模板
│   ├── search.html     # 搜索页模板
│   └── detail.html     # 详情页模板
└── prescriptions.db    # SQLite数据库
```

### 测试功能
```bash
# 运行API测试
cd 中药方管理系统
source venv/bin/activate
python3 test_api.py
```

## 📞 技术支持

### 常见问题

**Q: 应用启动失败怎么办？**
A: 检查端口5001是否被占用，或查看启动日志

**Q: 搜索结果不准确？**
A: 尝试使用不同的匹配模式，检查关键词是否在疗效字段中

**Q: 如何备份数据？**
A: 直接复制prescriptions.db文件即可

**Q: 支持批量导入吗？**
A: 当前版本需要手动添加，可通过API批量导入

### 日志查看
```bash
# 查看应用日志
tail -f app.log

# 查看Flask进程
ps aux | grep python
```

## 📝 更新日志

### v1.0.0 (2025-12-06)
- ✅ 完整的药方CRUD功能
- ✅ 强大的关键词搜索功能
- ✅ 多种搜索匹配模式
- ✅ 分类筛选功能
- ✅ 搜索历史记录
- ✅ 响应式界面设计
- ✅ RESTful API接口
- ✅ 数据统计功能

## 📄 许可证

MIT License - 可自由使用和修改